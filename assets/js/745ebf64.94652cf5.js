"use strict";(self.webpackChunkrciam_docs=self.webpackChunkrciam_docs||[]).push([[384],{1678:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return d},toc:function(){return s},default:function(){return k}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),o=["components"],l={sidebar_position:1},p="Service Providers",d={unversionedId:"developer/guide-for-sps",id:"developer/guide-for-sps",isDocsHomePage:!1,title:"Service Providers",description:"This page contains information about using the OpenAIRE AAI for securing access",source:"@site/docs/developer/guide-for-sps.md",sourceDirName:"developer",slug:"/developer/guide-for-sps",permalink:"/login-docs/docs/developer/guide-for-sps",editUrl:"https://github.com/openaire/login-docs/tree/main/docs/docs/developer/guide-for-sps.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/login-docs/docs/overview"},next:{title:"Glossary",permalink:"/login-docs/docs/glossary"}},s=[{value:"Service Provider integration workflow",id:"service-provider-integration-workflow",children:[]},{value:"General Information",id:"general-information",children:[]},{value:"SAML Service Provider",id:"saml-service-provider",children:[{value:"Metadata registration",id:"metadata-registration",children:[]},{value:"Metadata",id:"metadata",children:[]},{value:"Attributes",id:"attributes",children:[]},{value:"Attribute-based authorisation",id:"attribute-based-authorisation",children:[]},{value:"References",id:"references",children:[]}]},{value:"OpenID Connect Service Provider",id:"openid-connect-service-provider",children:[{value:"Client registration",id:"client-registration",children:[]},{value:"Claims",id:"claims",children:[]},{value:"Grant Types",id:"grant-types",children:[]},{value:"Endpoints",id:"endpoints",children:[]},{value:"Claims-based authorisation",id:"claims-based-authorisation",children:[]},{value:"Example OIDC Client",id:"example-oidc-client",children:[]},{value:"Client Migration to Keycloak",id:"client-migration-to-keycloak",children:[]}]},{value:"User attributes",id:"user-attributes",children:[{value:"1. User Identifier",id:"1-user-identifier",children:[]},{value:"2. Display Name",id:"2-display-name",children:[]},{value:"3. Given Name",id:"3-given-name",children:[]},{value:"4. Family Name",id:"4-family-name",children:[]},{value:"5. Email Address",id:"5-email-address",children:[]},{value:"6. Verified email flag",id:"6-verified-email-flag",children:[]},{value:"8. Affiliation",id:"8-affiliation",children:[]},{value:"9. Groups",id:"9-groups",children:[]},{value:"10. ORCID iD",id:"10-orcid-id",children:[]}]},{value:"User authorisation",id:"user-authorisation",children:[{value:"VO/group membership and role information",id:"vogroup-membership-and-role-information",children:[]}]}],m={toc:s};function k(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"service-providers"},"Service Providers"),(0,r.kt)("p",null,"This page contains information about using the OpenAIRE AAI for securing access\nto your service. The OpenAIRE AAI supports both OpenID Connect (an extension to\nOAuth 2.0) and SAML 2.0. So the first thing you need to decide is which of the\ntwo you are going to use. If you want you can also choose to secure some with\nOpenID Connect and others with SAML. To secure your services you are also going\nto need a library for the protocol you\u2019ve selected. Once your service is\nconnected to the OpenAIRE AAI, users will be able to choose from a wide range of\nacademic and social Identity Providers in order to access your service."),(0,r.kt)("h2",{id:"service-provider-integration-workflow"},"Service Provider integration workflow"),(0,r.kt)("p",null,"To integrate your Service Provider with the OpenAIRE AAI, you need to send us an\nemail to ",(0,r.kt)("inlineCode",{parentName:"p"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<AT>")," ",(0,r.kt)("inlineCode",{parentName:"p"},"openaire.eu")," indicating your request."),(0,r.kt)("p",null,"The integration follows a two-step process:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Register your Service Provider and test integration with the ",(0,r.kt)("strong",{parentName:"li"},"BETA"),"\ninstance of the OpenAIRE AAI. The BETA instance allows for testing\nauthentication and authorisation through the available academic and social\nIdentity Providers but shares no information (e.g. users, groups or roles)\nwith the production instance of the OpenAIRE AAI."),(0,r.kt)("li",{parentName:"ol"},"Register your Service Provider with the ",(0,r.kt)("strong",{parentName:"li"},"production")," instance of the\nOpenAIRE AAI. The production instance enables access to your service through\nany of the available academic and social Identity Providers. Moving to\nproduction requires that your service integration has been thoroughly tested\nduring Step 1.")),(0,r.kt)("p",null,"The most important URLs for each environment are listed in the table below but\nmore information can be found in the protocol-specific sections that follow."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Protocol"),(0,r.kt)("th",{parentName:"tr",align:null},"Production environment"),(0,r.kt)("th",{parentName:"tr",align:null},"BETA environment"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SAML"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/proxy/saml2/idp/metadata.php"},"https://aai.openaire.eu/proxy/saml2/idp/metadata.php")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/proxy/saml2/idp/metadata.php"},"https://beta.aai.openaire.eu/proxy/saml2/idp/metadata.php"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"OpenID Connect"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/.well-known/openid-configuration"},"https://aai.openaire.eu/oidc/.well-known/openid-configuration")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration"},"https://aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/.well-known/openid-configuration"},"https://beta.aai.openaire.eu/oidc/.well-known/openid-configuration")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration"},"https://beta.aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration")," (Keycloak)")))))),(0,r.kt)("h2",{id:"general-information"},"General Information"),(0,r.kt)("p",null,"OpenAIRE AAI supports two authentication and authorisation protocols that you\ncan choose from:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"http://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html"},"Security Assertion Markup Language (SAML) 2.0")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://openid.net/specs/openid-connect-core-1_0.html"},"OpenID Connect")," - an\nextension to ",(0,r.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc6749"},"OAuth 2.0"))),(0,r.kt)("p",null,"Regardless of which of the two protocols you are going to use, you need to\nprovide the following information to connect your service to OpenAIRE AAI:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Name of the service (in English and optionally in other languages supported\nby the service)"),(0,r.kt)("li",{parentName:"ol"},"Short description of the service"),(0,r.kt)("li",{parentName:"ol"},"Website (URL) for localised information about the service; the content found\nat the URL SHOULD provide more complete information than what provided by the\ndescription"),(0,r.kt)("li",{parentName:"ol"},"Contact information of the following types:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Helpdesk/Support contact information (for redirecting user)"),(0,r.kt)("li",{parentName:"ul"},"Administrative"),(0,r.kt)("li",{parentName:"ul"},"Technical"),(0,r.kt)("li",{parentName:"ul"},"Security/incident response"))),(0,r.kt)("li",{parentName:"ol"},"Privacy statement URL: The privacy policy is used to document the data\ncollected and processed by the service. You can use the\n",(0,r.kt)("a",{parentName:"li",href:"https://docs.google.com/document/d/1ZU7VjH3g7qcfWcz0Z8TTv-vQiVoRA_wOsuMyJaz28Og/edit"},"Privacy Policy template")),(0,r.kt)("li",{parentName:"ol"},"Acceptable Use Policy / Terms of Use URL (see\n",(0,r.kt)("a",{parentName:"li",href:"https://wise-community.org/wise-baseline-aup/"},"WISE AUP Baseline template"),")"),(0,r.kt)("li",{parentName:"ol"},"Logo URL (optional for showing in catalogues); if provided, logos SHOULD:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"use a transparent background where appropriate to facilitate the usage of\nlogos within a user interface"),(0,r.kt)("li",{parentName:"ul"},"use PNG, or GIF (less preferred), images"),(0,r.kt)("li",{parentName:"ul"},"use HTTPS URLs in order to avoid mixed-content warnings within browsers"),(0,r.kt)("li",{parentName:"ul"},"have a size larger than 40000 and smaller than 50000 characters when\nencoded in base64"))),(0,r.kt)("li",{parentName:"ol"},"Country of the service")),(0,r.kt)("h2",{id:"saml-service-provider"},"SAML Service Provider"),(0,r.kt)("p",null,"To enable federated access to a web-based application, you can connect to the\nOpenAIRE AAI IdP as a SAML Service Provider (SP). Users of the application will\nbe redirected to OpenAIRE AAI in order to log in, and OpenAIRE AAI can\nauthenticate them using any of the supported backend authentication mechanisms,\nsuch as institutional IdPs registered with eduGAIN or Social Providers. Once the\nuser is authenticated, OpenAIRE AAI will return a SAML assertion to the\napplication containing information about the authenticated user."),(0,r.kt)("h3",{id:"metadata-registration"},"Metadata registration"),(0,r.kt)("p",null,"SAML authentication relies on the use of metadata. Both parties (you as a SP and\nthe OpenAIRE AAI IdP) need to exchange metadata in order to know and trust each\nother. The metadata include information such as the location of the service\nendpoints that need to be invoked, as well as the certificates that will be used\nto sign SAML messages. The format of the exchanged metadata should be based on\nthe XML-based\n",(0,r.kt)("a",{parentName:"p",href:"https://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf"},"SAML 2.0 specification"),".\nUsually, you will not need to manually create such an XML document, as this is\nautomatically generated by all major SAML 2.0 SP software solutions (e.g.,\nShibboleth, SimpleSAMLphp, and ",(0,r.kt)("inlineCode",{parentName:"p"},"mod_auth_mellon"),"). It is important that you\nserve your metadata over HTTPS using a browser-friendly SSL certificate, i.e.\nissued by a trusted certificate authority."),(0,r.kt)("p",null,"You can get the metadata of the OpenAIRE AAI IdP Proxy on a dedicated URL that\ndepends on the integration environment being used:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Production environment"),(0,r.kt)("th",{parentName:"tr",align:null},"BETA environment"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/proxy/saml2/idp/metadata.php"},"https://aai.openaire.eu/proxy/saml2/idp/metadata.php")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/proxy/saml2/idp/metadata.php"},"https://beta.aai.openaire.eu/proxy/saml2/idp/metadata.php"))))),(0,r.kt)("p",null,"To register your SAML SP, you need to send an email to ",(0,r.kt)("inlineCode",{parentName:"p"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<AT>"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"openaire.eu"),". Your message should include the general information about your\nservice (see ",(0,r.kt)("a",{parentName:"p",href:"#general-information"},"General Information"),") and the SP's metadata\nURL and ",(0,r.kt)("inlineCode",{parentName:"p"},"entityID"),"."),(0,r.kt)("h3",{id:"metadata"},"Metadata"),(0,r.kt)("p",null,"Metadata provided by your SP should contain a descriptive name of the service\nthat your SP represents in at least English. It is recommended to also provide\nthe name in other languages which are commonly used in the geographic scope of\nthe deployment. The name should be placed in the ",(0,r.kt)("inlineCode",{parentName:"p"},"<md:ServiceName>")," in the\n",(0,r.kt)("inlineCode",{parentName:"p"},"<md:AttributeConsumingService>")," container."),(0,r.kt)("p",null,"It is recommended that your SP metadata contains:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"an <md:SPSSODescriptor> role element containing",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"at least one <md:AssertionConsumerService> endpoint element"),(0,r.kt)("li",{parentName:"ul"},"at least one <md:KeyDescriptor> element whose use attribute is omitted or\nset to encryption"),(0,r.kt)("li",{parentName:"ul"},"an <md:Extensions> element at the role level containing",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"an <mdui:UIInfo> extension element containing the child elements\n<mdui:DisplayName>, <mdui:Logo>, and <mdui:PrivacyStatementURL>"),(0,r.kt)("li",{parentName:"ul"},"an <mdattr:EntityAttributes> extension element for signaling Subject\nIdentifier requirements with previously prescribed content"))),(0,r.kt)("li",{parentName:"ul"},"an <md:ContactPerson> element with a contactType of support and/or a\n<md:ContactPerson> element with a contactType of technical. The\n<md:ContactPerson> element(s) should contain at least one <md:EmailAddress>.\nThe support address may be used for generic support questions about the\nservice, while the technical contact may be contacted regarding technical\ninteroperability problems. The technical contact must be responsible for the\ntechnical operation of the service represented by your SP.")))),(0,r.kt)("p",null,"If the SP supports the Single Logout profile, then its metadata MUST contain\n(within its <md:SPSSODescriptor> role element):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"at least one <md:KeyDescriptor> element whose use attribute is omitted or set\nto signing"),(0,r.kt)("li",{parentName:"ul"},"at least one <md:SingleLogoutService> endpoint element (this MAY be omitted if\nthe SP solely issues <samlp:LogoutRequest> messages containing the\n<aslo:Asynchronous> extension\n[",(0,r.kt)("a",{parentName:"li",href:"http://docs.oasis-open.org/security/saml/Post2.0/saml-async-slo/v1.0/cs01/saml-async-slo-v1.0-cs01.pdf"},"SAML2ASLO"),"])")),(0,r.kt)("h3",{id:"attributes"},"Attributes"),(0,r.kt)("p",null,"The OpenAIRE AAI IdP is guaranteed to release a minimal subset of the\n",(0,r.kt)("a",{parentName:"p",href:"https://refeds.org/category/research-and-scholarship"},"REFEDS R&S")," attribute\nbundle to connected Service Providers without administrative involvement,\nsubject to user consent. The following attributes constitute a minimal subset of\nthe R&S attribute bundle:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Persistent, non-reassignable, non-targeted, opaque, globally unique OpenAIRE\nLogin user ID (",(0,r.kt)("inlineCode",{parentName:"li"},"eduPersonUniqueId"),"); this is always scoped ",(0,r.kt)("inlineCode",{parentName:"li"},"@aai.openaire.eu")),(0,r.kt)("li",{parentName:"ul"},"Email address (",(0,r.kt)("inlineCode",{parentName:"li"},"mail"),")"),(0,r.kt)("li",{parentName:"ul"},"Display name (",(0,r.kt)("inlineCode",{parentName:"li"},"displayName"),") OR (",(0,r.kt)("inlineCode",{parentName:"li"},"givenName")," AND ",(0,r.kt)("inlineCode",{parentName:"li"},"sn"),")")),(0,r.kt)("p",null,"A more extensive list of all the attributes that may be made available to\nService Providers is included in the ",(0,r.kt)("a",{parentName:"p",href:"#user-attributes"},"User Attribute")," section."),(0,r.kt)("h3",{id:"attribute-based-authorisation"},"Attribute-based authorisation"),(0,r.kt)("p",null,"OpenAIRE AAI provides information about the authenticated user that may be used\nby Service Providers in order to control user access to resources. This\ninformation is provided by the OpenAIRE AAI IdP in the\n",(0,r.kt)("a",{parentName:"p",href:"#attributes"},"SAML attribute assertion"),". The table below lists the SAML\nattributes that are relevant for user authorisation:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"SAML Attribute"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#vogroup-membership-and-role-information"},"VO/group membership/roles of the authenticated user")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"eduPersonEntitlement"))))),(0,r.kt)("h3",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://shibboleth.atlassian.net/wiki/spaces/SP3/overview"},"Shibboleth Service Provider Documentation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://simplesamlphp.org/docs/stable/simplesamlphp-sp"},"SimpleSAMLphp Service Provider QuickStart")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/latchset/mod_auth_mellon"},"Simple SAML 2.0 service provider with mod_auth_mellon Apache module"))),(0,r.kt)("h2",{id:"openid-connect-service-provider"},"OpenID Connect Service Provider"),(0,r.kt)("p",null,"Service Providers can be integrated with OpenAIRE AAI using OpenID Connect\n(OIDC) as an alternative to the SAML2 protocol. To allow this, the OpenAIRE\nLogin IdP provides an OpenID Connect (OAuth2) API based on\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server"},"MITREid Connect"),",\nwhich has been\n",(0,r.kt)("a",{parentName:"p",href:"http://openid.net/certification/"},"certified by the OpenID Foundation"),".\nInterconnection with the OpenAIRE AAI OpenID Provider allows users to sign in\nusing any of the supported backend authentication mechanisms, such as\ninstitutional IdPs registered with eduGAIN or Social Providers. Once the user\nhas signed in, OpenAIRE AAI can return OIDC Claims containing information about\nthe authenticated user."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The OpenAIRE AAI OpenID Provider is being migrated to Keycloak. Please check\n",(0,r.kt)("a",{parentName:"p",href:"#client-migration-to-keycloak"},"OIDC Client Migration to Keycloak")," for more\ndetails"))),(0,r.kt)("h3",{id:"client-registration"},"Client registration"),(0,r.kt)("p",null,"Before your service can use the OpenAIRE AAI OpenID Provider for user login, you\nmust register a client and obtain OAuth 2.0 client credentials by contacting\n",(0,r.kt)("inlineCode",{parentName:"p"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<AT>")," ",(0,r.kt)("inlineCode",{parentName:"p"},"openaire.eu"),". OAuth2 credentials typically include a client ID and\nclient secret. You also need to specify:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"One or more Redirection URI(s) to indicate where the OpenAIRE OIDC Provider\nsends responses to your authentication requests. Note that the Redirection\nURI(s) MUST use the https scheme."),(0,r.kt)("li",{parentName:"ul"},"One or more scopes to indicate the requested Claims about the End-User (see\n",(0,r.kt)("a",{parentName:"li",href:"#claims"},"Claims")," section)"),(0,r.kt)("li",{parentName:"ul"},"The OpenID Connect/OAuth2 grant type (see ",(0,r.kt)("a",{parentName:"li",href:"#grant-types"},"Grant Types")," section)"),(0,r.kt)("li",{parentName:"ul"},"One or more Post Logout Redirection URI(s) to indicate the URLs allowed to\nrequest that the End-User's browser be redirected after a logout has been\nperformed using the ",(0,r.kt)("inlineCode",{parentName:"li"},"post_logout_redirect_uri")," parameter.")),(0,r.kt)("h4",{id:"setting-additional-information-about-the-client"},"Setting additional information about the client"),(0,r.kt)("p",null,"It is strongly suggested that you add a short ",(0,r.kt)("strong",{parentName:"p"},"description")," and a ",(0,r.kt)("strong",{parentName:"p"},"logo")," for\nthe client. Lastly, you need to set the ",(0,r.kt)("strong",{parentName:"p"},"email addresses")," of one or more\ncontacts."),(0,r.kt)("h3",{id:"claims"},"Claims"),(0,r.kt)("p",null,"The OpenAIRE AAI UserInfo Endpoint is an OAuth 2.0 Protected Resource that\nreturns specific information about the authenticated End-User as Claim Values.\nTo obtain the requested Claims about the End-User, the Client makes a request to\nthe UserInfo Endpoint using an Access Token obtained through OpenID Connect\nAuthentication. The scopes associated with the Access Token used to access the\nOpenAIRE AAI UserInfo Endpoint will determine what Claims will be released.\nThese Claims are represented by a JSON object that contains a collection of name\nand value pairs for the Claims."),(0,r.kt)("p",null,"The following scope values can be used to request Claims from the OpenAIRE AAI\nUserInfo Endpoint:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Scope"),(0,r.kt)("th",{parentName:"tr",align:null},"Claims"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"openid")),(0,r.kt)("td",{parentName:"tr",align:null},"User Identifier (",(0,r.kt)("inlineCode",{parentName:"td"},"sub"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"voperson_id")),(0,r.kt)("td",{parentName:"tr",align:null},"User Identifier (",(0,r.kt)("inlineCode",{parentName:"td"},"voperson_id"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"profile")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Display Name (",(0,r.kt)("inlineCode",{parentName:"td"},"name"),")"),(0,r.kt)("li",null,"Given Name (",(0,r.kt)("inlineCode",{parentName:"td"},"given_name"),")"),(0,r.kt)("li",null,"Family Name (",(0,r.kt)("inlineCode",{parentName:"td"},"family_name"),")")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"email")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Email Address (",(0,r.kt)("inlineCode",{parentName:"td"},"email"),")"),(0,r.kt)("li",null,"Email Verification Status (",(0,r.kt)("inlineCode",{parentName:"td"},"email_verified"),")")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"eduperson_entitlement")),(0,r.kt)("td",{parentName:"tr",align:null},"Groups (",(0,r.kt)("inlineCode",{parentName:"td"},"eduperson_entitlement"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"voperson_external_affiliation")),(0,r.kt)("td",{parentName:"tr",align:null},"Affiliation (",(0,r.kt)("inlineCode",{parentName:"td"},"voperson_external_affiliation"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"orcid")),(0,r.kt)("td",{parentName:"tr",align:null},"ORCID iD (",(0,r.kt)("inlineCode",{parentName:"td"},"orcid"),")")))),(0,r.kt)("p",null,"A more extensive list of all the attributes that may be made available to\nService Providers is included in the ",(0,r.kt)("a",{parentName:"p",href:"#user-attributes"},"User Attribute")," section."),(0,r.kt)("h3",{id:"grant-types"},"Grant Types"),(0,r.kt)("p",null,"OpenAIRE AAI supports the following OpenID Connect/OAuth2 grant types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Authorization Code: used by Web Apps executing on a server."),(0,r.kt)("li",{parentName:"ul"},"Token Exchange: used by clients to request and obtain security tokens in\nsupport of delegated access to resources."),(0,r.kt)("li",{parentName:"ul"},"Device Code: used by devices that lack a browser to perform a user-agent based\nOAuth flow.")),(0,r.kt)("h3",{id:"endpoints"},"Endpoints"),(0,r.kt)("p",null,"The most important OIDC/OAuth2 endpoints are listed below:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Endpoint"),(0,r.kt)("th",{parentName:"tr",align:null},"Production environment"),(0,r.kt)("th",{parentName:"tr",align:null},"BETA environment"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Provider configuration"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/.well-known/openid-configuration"},"https://aai.openaire.eu/oidc/.well-known/openid-configuration")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration"},"https://aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/.well-known/openid-configuration"},"https://beta.aai.openaire.eu/oidc/.well-known/openid-configuration")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration"},"https://beta.aai.openaire.eu/auth/realms/openaire/.well-known/openid-configuration")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Client registration"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Contact us at ",(0,r.kt)("inlineCode",{parentName:"em"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"em"},"<AT>")," ",(0,r.kt)("inlineCode",{parentName:"em"},"openaire.eu"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"Contact us at ",(0,r.kt)("inlineCode",{parentName:"em"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"em"},"<AT>")," ",(0,r.kt)("inlineCode",{parentName:"em"},"openaire.eu")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Issuer"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"https://aai.openaire.eu/oidc/")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"https://aai.openaire.eu/auth/realms/openaire")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"https://beta.aai.openaire.eu/oidc/")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"https://beta.aai.openaire.eu/auth/realms/openaire")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Authorisation"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/authorize"},"https://aai.openaire.eu/oidc/authorize")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth"},"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/authorize"},"https://beta.aai.openaire.eu/oidc/authorize")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth"},"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Token"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/token"},"https://aai.openaire.eu/oidc/token")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token"},"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/token"},"https://beta.aai.openaire.eu/oidc/token")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token"},"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Device Code"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/devicecode"},"https://aai.openaire.eu/oidc/devicecode")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth/device"},"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth/device")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/devicecode"},"https://beta.aai.openaire.eu/oidc/devicecode")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth/device"},"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/auth/device")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JSON Web Key(jwt)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/jwk"},"https://aai.openaire.eu/oidc/jwk")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/certs"},"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/certs")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/jwk"},"https://beta.aai.openaire.eu/oidc/jwk")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/certs"},"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/certs")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"User Info"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/userinfo"},"https://aai.openaire.eu/oidc/userinfo")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/userinfo"},"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/userinfo")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/userinfo"},"https://beta.aai.openaire.eu/oidc/userinfo")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/userinfo"},"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/userinfo")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Introspection"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/introspect"},"https://aai.openaire.eu/oidc/introspect")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token/introspect"},"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token/introspect")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/introspect"},"https://beta.aai.openaire.eu/oidc/introspect")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token/introspect"},"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/token/introspect")," (Keycloak)")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Logout"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/oidc/saml/logout"},"https://aai.openaire.eu/oidc/saml/logout")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/logout"},"https://aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/logout")," (Keycloak)"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/oidc/saml/logout"},"https://beta.aai.openaire.eu/oidc/saml/logout")," (MITREid Connect)"),(0,r.kt)("li",null,(0,r.kt)("a",{parentName:"td",href:"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/logout"},"https://beta.aai.openaire.eu/auth/realms/openaire/protocol/openid-connect/logout")," (Keycloak)")))))),(0,r.kt)("h4",{id:"authorization-endpoint"},"Authorization Endpoint"),(0,r.kt)("p",null,"The Authorization Endpoint performs Authentication of the End-User. This is done\nby sending the User Agent to the Authorization Server\\'s Authorization Endpoint\nfor Authentication and Authorization, using request parameters defined by OAuth\n2.0 and additional parameters and parameter values defined by OpenID Connect."),(0,r.kt)("p",null,"The request parameters of the Authorization endpoint are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client_id"),": id of the client that ask for authentication to the Authorization\nServer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"redirect_uri"),": URI to which the response will be sent."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scope"),": A list of attributes that the application requires."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"state"),": Opaque value used to maintain state between the request and the\ncallback."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"response_type"),": value that determines the authorization processing flow to be\nused. For ",(0,r.kt)("strong",{parentName:"li"},"Authorization Code")," grant set ",(0,r.kt)("inlineCode",{parentName:"li"},"response_type=code"),". This way the\nresponse will include an authorization code.")),(0,r.kt)("h4",{id:"token-endpoint"},"Token Endpoint"),(0,r.kt)("p",null,"To obtain an Access Token, an ID Token, and optionally a Refresh Token, the\nClient sends a Token Request to the Token Endpoint."),(0,r.kt)("p",null,"Depending on the grant type, the following parameters are required:"),(0,r.kt)("h5",{id:"authorization-code"},"Authorization Code"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Presence"),(0,r.kt)("th",{parentName:"tr",align:null},"Values"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"grant_type")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"authorization_code"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"code")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The value of the code in the response from authorization endpoint.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"redirect_uri")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"URI to which the response will be sent (must be the same as the request to authorization endpoint)")))),(0,r.kt)("h5",{id:"proof-key-for-code-exchange-pkce"},"Proof Key for Code Exchange (PKCE)"),(0,r.kt)("p",null,"The Proof Key for Code Exchange (PKCE, pronounced pixie) extension\n(",(0,r.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc7636"},"RFC 7636"),") describes a technique for\npublic clients (clients without ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret"),") to mitigate the threat of\nhaving the authorization code intercepted. The technique involves the client\nfirst creating a secret, and then using that secret again when exchanging the\nauthorization code for an access token. This way if the code is intercepted, it\nwill not be useful since the token request relies on the initial secret."),(0,r.kt)("h6",{id:"client-configuration"},"Client configuration"),(0,r.kt)("p",null,"To enable PKCE you need to send an email to ",(0,r.kt)("inlineCode",{parentName:"p"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<AT>")," ",(0,r.kt)("inlineCode",{parentName:"p"},"openaire.eu"),",\nindicating the ",(0,r.kt)("inlineCode",{parentName:"p"},"client_id")," of the client, and request to enable PKCE."),(0,r.kt)("h6",{id:"protocol-flow"},"Protocol Flow"),(0,r.kt)("p",null,"Because the PKCE-enhanced Authorization Code Flow builds upon the standard\nAuthorization Code Flow, the steps are very similar."),(0,r.kt)("p",null,"First, the client creates and records a secret named the ",(0,r.kt)("inlineCode",{parentName:"p"},"code_verifier"),". The\n",(0,r.kt)("inlineCode",{parentName:"p"},"code_verifier")," is a high-entropy cryptographic random STRING using the\nunreserved characters ","[A-Z]"," / ","[a-z]"," / ","[0-9]",' / "-" / "." / "',"_",'" / "~", with a\nminimum length of 43 characters and a maximum length of 128 characters. Then the\nclient creates a ',(0,r.kt)("inlineCode",{parentName:"p"},"code_challenge")," derived from the ",(0,r.kt)("inlineCode",{parentName:"p"},"code_verifier")," by using one\nof the following transformations on the code verifier:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"plain")," code_challenge = code_verifier"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"S256")," code_challenge = BASE64URL-ENCODE(SHA256(ASCII(code_verifier)))")),(0,r.kt)("p",null,"If the client is capable of using ",(0,r.kt)("inlineCode",{parentName:"p"},"S256"),", it MUST use ",(0,r.kt)("inlineCode",{parentName:"p"},"S256"),". Clients are\npermitted to use ",(0,r.kt)("inlineCode",{parentName:"p"},"plain")," only if they cannot support ",(0,r.kt)("inlineCode",{parentName:"p"},"S256")," for some technical\nreason."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"There are various tools that generate these values such as\n",(0,r.kt)("a",{parentName:"p",href:"https://tonyxu-io.github.io/pkce-generator/"},"https://tonyxu-io.github.io/pkce-generator/")))),(0,r.kt)("p",null,"Then the ",(0,r.kt)("inlineCode",{parentName:"p"},"code_challenge")," is sent in the Authorization Request along with the\ntransformation method (",(0,r.kt)("inlineCode",{parentName:"p"},"code_challenge_method"),")."),(0,r.kt)("p",null,"Example request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'GET "${AUTHORISATION_ENDPOINT}?\n      client_id=${CLIENT_ID}\n      &scope=openid%20profile%20email\n      &redirect_uri=${REDIRECT_URI}\n      &response_type=code\n      &code_challenge=${CODE_CHALLENGE}\n      &code_challenge_method=S256"\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Authorisation Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("p",null,"The Authorization Endpoint responds as usual but records ",(0,r.kt)("inlineCode",{parentName:"p"},"code_challenge")," and\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"code_challenge_method"),"."),(0,r.kt)("p",null,"Example response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"HTTP/1.1 302 Found\n  Location: ${REDIRECT_URI}?\n    code=fgtLHT\n")),(0,r.kt)("p",null,"The client then sends the authorization code in the Access Token Request as\nusual but includes the ",(0,r.kt)("inlineCode",{parentName:"p"},"code_verifier")," secret generated in the first request."),(0,r.kt)("p",null,"Example request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -X POST "${TOKEN_ENDPOINT}" \\\n  -d "grant_type=authorization_code" \\\n  -d "code=${CODE}" \\\n  -d "client_id=${CLIENT_ID}" \\\n  -d "redirect_uri=${REDIRECT_URI}" \\\n  -d "code_verifier=${CODE_VERIFIER}" | python -m json.tool\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Token Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("p",null,"The authorization server transforms ",(0,r.kt)("inlineCode",{parentName:"p"},"code_verifier")," and compares it to\n",(0,r.kt)("inlineCode",{parentName:"p"},"code_challenge")," from the first request. Access is denied if they are not equal."),(0,r.kt)("p",null,"Example response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "eyJraWQiOiJvaWRjIiwiYWxnIjoiUlMyNTYifQ...",\n  "expires_in": 3599,\n  "id_token": "eyJraWQiOiJvaWRjIiwiYWxnIjoiUlMyNTYifQ...",\n  "scope": "openid email profile",\n  "token_type": "Bearer"\n}\n')),(0,r.kt)("h5",{id:"refresh-request"},"Refresh request"),(0,r.kt)("p",null,"The following request allows obtaining an access token from a refresh token\nusing the ",(0,r.kt)("inlineCode",{parentName:"p"},"grant_type")," value ",(0,r.kt)("inlineCode",{parentName:"p"},"refresh_token"),":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Presence"),(0,r.kt)("th",{parentName:"tr",align:null},"Values"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"client_id")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The identifier of the client.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"client_secret")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The secret value of the client.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"grant_type")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"refresh_token"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"refresh_token")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"The value of the refresh token"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"scope")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"This parameter should contain openid at least")))),(0,r.kt)("p",null,"Example request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl\xa0-X\xa0POST "${TOKEN_ENDPOINT}" \\\n  -u\xa0"${CLIENT_ID}":"${CLIENT_SECRET}"\xa0\\\n  -d\xa0"grant_type=refresh_token"\xa0\\\n  -d\xa0"refresh_token=${REFRESH_TOKEN}"\xa0\\\n  -d\xa0"scope=openid%20email%20profile"\xa0|\xa0python\xa0-m\xa0json.tool;\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Token Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("p",null,"Example response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "eyJraWQiOiJvaWRjIiwiYWx...",\n  "expires_in": 3599,\n  "id_token": "eyJraWQiOiJvaWRjIiwiYW...",\n  "refresh_token": "eyJhbGciOiJub25...",\n  "scope": "openid\xa0profile\xa0email",\n  "token_type": "Bearer"\n}\n')),(0,r.kt)("h6",{id:"refresh-request-with-pkce"},"Refresh Request with PKCE"),(0,r.kt)("p",null,"To combine the refresh token grant type with PKCE you need to make the following\nrequest:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl\xa0-X\xa0POST\xa0"${TOKEN_ENDPOINT}"\xa0\\\n  -d\xa0"client_id=${CLIENT_ID}"\xa0\\\n  -d\xa0"grant_type=refresh_token"\xa0\\\n  -d\xa0"refresh_token=${REFRESH_TOKEN}"\xa0\\\n  -d\xa0"scope=openid%20email%20profile"\xa0|\xa0python\xa0-m\xa0json.tool;\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Token Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("h5",{id:"token-exchange"},"Token Exchange"),(0,r.kt)("p",null,"To get a token from client B using a token issued for client A, the parameters\nof the request are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Presence"),(0,r.kt)("th",{parentName:"tr",align:null},"Values"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"grant_type")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"urn:ietf:params:oauth:grant-type:token-exchange"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"audience")),(0,r.kt)("td",{parentName:"tr",align:null},"Optional"),(0,r.kt)("td",{parentName:"tr",align:null},"Define the logical name of the service that the token will be used for")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"subject_token")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The value of the access token")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"subject_token_type")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"urn:ietf:params:oauth:token-type:access_token")," (because\xa0this\xa0feature\xa0accepts\xa0access\xa0tokens\xa0only)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"scope")),(0,r.kt)("td",{parentName:"tr",align:null},"Optional"),(0,r.kt)("td",{parentName:"tr",align:null},"Define one or more scopes that are contained in the original token; otherwise all scopes will be selected")))),(0,r.kt)("p",null,"Example request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl\xa0-X\xa0POST\xa0"${TOKEN_ENDPOINT}" \\\n  -u\xa0"${CLIENT_B_ID}":"${CLIENT_B_SECRET}"\xa0\\\n  -d\xa0"grant_type=urn:ietf:params:oauth:grant-type:token-exchange"\xa0\\\n  -d\xa0"audience=tokenExchange"\xa0\\\n  -d\xa0"subject_token=${ACCESS_TOKEN_A}"\xa0\\\n  -d\xa0"subject_token_type=urn:ietf:params:oauth:token-type:access_token"\xa0\\\n  -d\xa0"scope=openid%20profile%20offline_access"\xa0|\xa0python\xa0-m\xa0json.tool;\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Token Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("p",null,"Example response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "eyJraWQiOiJvaWRjIiwiYWxnIjoiUl...",\n  "expires_in": 3599,\n  "id_token": "eyJraWQiOiJvaWRjIiwiYWxnIjoiUl...",\n  "refresh_token": "eyJhbGciOiJub25lIn0.eyJleHAiO...",\n  "scope": "openid\xa0profile\xa0offline_access",\n  "token_type": "Bearer"\n}\n')),(0,r.kt)("h5",{id:"device-code"},"Device Code"),(0,r.kt)("p",null,"The device code flow enables OAuth clients on (input-constrained) devices to\nobtain user authorization for accessing protected resources without using an\non-device user-agent, provided that they have an Internet connection."),(0,r.kt)("h6",{id:"1-device-authorization-request"},"1. Device Authorization Request"),(0,r.kt)("p",null,'The\xa0client\xa0initiates\xa0the\xa0authorization\xa0flow\xa0by\xa0requesting\xa0a\xa0set\xa0of\nverification\xa0codes\xa0from\xa0the\xa0authorization\xa0server\xa0by\xa0making\xa0an\xa0HTTP\xa0"POST"\nrequest\xa0to\xa0the\xa0device\xa0authorization\xa0endpoint. The\xa0client\xa0constructs\xa0the\xa0request\nwith\xa0the\xa0following\xa0parameters:'),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Presence"),(0,r.kt)("th",{parentName:"tr",align:null},"Values"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"client_id")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The identifier of the client")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"scope")),(0,r.kt)("td",{parentName:"tr",align:null},"Optional"),(0,r.kt)("td",{parentName:"tr",align:null},"Define one or more scopes that are contained in the original token; otherwise all scopes will be selected")))),(0,r.kt)("p",null,"Example request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl\xa0-X\xa0POST\xa0"${DEVICE_CODE_ENDPOINT}"\xa0\\\n  -H\xa0"Content-Type:\xa0application/x-www-form-urlencoded"\xa0\\\n  -d\xa0"client_id=${CLIENT_ID}"\xa0\\\n  -d\xa0"scope=openid%20email%20profile"\xa0|\xa0python\xa0-m\xa0json.tool\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Device Code Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("p",null,"Example response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "device_code": "c4341bd6-5e82-4f9c-9f6f-5842409d48db",\n  "expires_in": 600,\n  "user_code": "IEJSJB",\n  "verification_uri": "https://aai.openaire.eu/oidc/device"\n}\n')),(0,r.kt)("h6",{id:"2-user-interaction"},"2. User Interaction"),(0,r.kt)("p",null,"After\xa0receiving\xa0a\xa0successful\xa0Authorization\xa0Response,\xa0the\xa0client\xa0displays\xa0or\notherwise\xa0communicates\xa0the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"user_code"),"\xa0and\xa0the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"verification_uri"),"\xa0to\xa0the\xa0end\nuser\xa0and\xa0instructs\xa0them\xa0to\xa0visit\xa0the\xa0URI\xa0in\xa0a\xa0user\xa0agent\xa0on\xa0a\xa0secondary\ndevice\xa0(for\xa0example,\xa0in\xa0a\xa0browser\xa0on\xa0their\xa0mobile\xa0phone),\xa0and\xa0enter\xa0the\nuser\xa0code."),(0,r.kt)("h6",{id:"3-device-access-token-request"},"3. Device Access Token Request"),(0,r.kt)("p",null,"After\xa0displaying\xa0instructions\xa0to\xa0the\xa0user,\xa0the\xa0client\xa0makes\xa0an\xa0Access\xa0Token\nRequest\xa0to\xa0the\xa0token\xa0endpoint.\xa0The\xa0request\xa0contains\xa0the\xa0following\xa0parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Presence"),(0,r.kt)("th",{parentName:"tr",align:null},"Values"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"grant_type")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"urn:ietf:params:oauth:grant-type:device_code"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"device_code")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The\xa0device\xa0verification\xa0code,\xa0",(0,r.kt)("inlineCode",{parentName:"td"},"device_code"),"\xa0from\xa0the\xa0Device\xa0Authorization\xa0Response")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"client_id")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The\xa0identifier\xa0of\xa0the\xa0client")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"client_secret")),(0,r.kt)("td",{parentName:"tr",align:null},"Required"),(0,r.kt)("td",{parentName:"tr",align:null},"The\xa0secret\xa0value\xa0of\xa0the\xa0client")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"scope")),(0,r.kt)("td",{parentName:"tr",align:null},"Optional"),(0,r.kt)("td",{parentName:"tr",align:null},"Define one or more scopes that are contained in the original token; otherwise all scopes will be selected")))),(0,r.kt)("p",null,"Example request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl\xa0-X\xa0POST\xa0"${TOKEN_ENDPOINT}" \\\n  -H\xa0"Content-Type:\xa0application/x-www-form-urlencoded"\xa0\\\n  -d\xa0"grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Adevice_code"\xa0\\\n  -d\xa0"device_code=${DEVICE_CODE}"\xa0\\\n  -d\xa0"client_id=${CLIENT_ID}"\xa0\\\n  -d\xa0"client_secret=${CLIENT_SECRET}"\xa0\\\n  -d\xa0"scope=openid%20profile"\xa0|\xa0python\xa0-m\xa0json.tool\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Token Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("p",null,"Example response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhZG1pbiIs...",\n  "expires_in": 3599,\n  "id_token": "eyJraWQiOiJyc2ExIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiI5MDM0Mi...",\n  "scope": "openid\xa0profile",\n  "token_type": "Bearer"\n}\n')),(0,r.kt)("h6",{id:"device-code-with-pkce"},"Device Code with PKCE"),(0,r.kt)("p",null,"To combine Device Code flow with PKCE you need to make the following requests:"),(0,r.kt)("p",null,"1 - Device Authorization Request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -X POST "${DEVICE_CODE_ENDPOINT}" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "client_id=${CLIENT_ID}" \\\n  -d "scope=openid%20email%20profile" \\\n  -d "code_challenge=${CODE_CHALLENGE}" \\\n  -d "code_challenge_method=S256" | python -m json.tool\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Device Code Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("p",null,"2 - Device Access Token Request"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -X POST "${TOKEN_ENDPOINT}" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Adevice_code" \\\n  -d "device_code=${DEVICE_CODE}" \\\n  -d "client_id=${CLIENT_ID}" \\\n  -d "code_verifier=${CODE_VERIFIER}" | python -m json.tool\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("em",{parentName:"p"},"Token Endpoint")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("h4",{id:"logout-endpoint"},"Logout Endpoint"),(0,r.kt)("p",null,"The OpenAIRE AAI OpenID Provider supports the\n",(0,r.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-rpinitiated-1_0.html"},"OpenID Connect RP-Initiated Logout"),"\nspecification where the logout starts by redirecting the user to a specific\nendpoint at the OpenID Provider."),(0,r.kt)("p",null,"This endpoint is normally obtained via the ",(0,r.kt)("inlineCode",{parentName:"p"},"end_session_endpoint")," element of the\nOP's Configuration page. Parameters used in the logout request are detailed\nbelow:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"id_token_hint"),": The ID Token previously issued by the OpenAIRE AAI OP to\nyour Relying Party (RP) and provided to the Logout Endpoint as a hint\nregarding the end user\u2019s current authenticated session with the client. It\nindicates the identity of the end user that the RP is requesting the\nOpenAIRE AAI to log out. If the ",(0,r.kt)("inlineCode",{parentName:"li"},"id_token_hint")," parameter is omitted, the\nuser may be prompted to confirm the logout."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client_id"),": This parameter is used to specify the Client Identifier when\n",(0,r.kt)("inlineCode",{parentName:"li"},"post_logout_redirect_uri")," is specified but ",(0,r.kt)("inlineCode",{parentName:"li"},"id_token_hint")," is not."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"post_logout_redirect_uri"),": URI to which the RP is requesting that the end\nuser\u2019s browser be redirected after a logout has been performed. This URI\nshould use the ",(0,r.kt)("inlineCode",{parentName:"li"},"HTTPS")," scheme and the value must have been previously\nregistered in the configuration of the client in the OpenAIRE AAI. Note\nthat you need to include either the ",(0,r.kt)("inlineCode",{parentName:"li"},"client_id")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"id_token_hint"),"\nparameter in case the ",(0,r.kt)("inlineCode",{parentName:"li"},"post_logout_redirect_uri")," is included.")),(0,r.kt)("p",null,"You can use either ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP GET")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP POST")," to send the logout request to\nthe Logout Endpoint."),(0,r.kt)("h5",{id:"example-requests"},"Example Requests"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"  HTTP/1.1 302 Found\n  Location: ${LOGOUT_ENDPOINT}?\n    id_token_hint=${ID_TOKEN}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"  HTTP/1.1 302 Found\n  Location: ${LOGOUT_ENDPOINT}?\n    client_id=${CLIENT_ID}\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can find the ",(0,r.kt)("inlineCode",{parentName:"p"},"LOGOUT_ENDPOINT")," in the ",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table."))),(0,r.kt)("h3",{id:"claims-based-authorisation"},"Claims-based authorisation"),(0,r.kt)("p",null,"OpenAIRE AAI provides information about the authenticated user that may be used\nby Service Providers in order to control user access to resources. This\ninformation is provided by the OpenAIRE AAI OpenID Provider in the form of\n",(0,r.kt)("a",{parentName:"p",href:"#claims"},"OIDC claims"),". The table below lists the claims that are relevant for\nuser authorisation:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"OIDC Claim"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#vogroup-membership-and-role-information"},"VO/group membership/roles of the authenticated user")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"eduperson_entitlement"))))),(0,r.kt)("h3",{id:"example-oidc-client"},"Example OIDC Client"),(0,r.kt)("p",null,"In this guide we will demonstrate how to install and configure a\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rciam/simple-oidc-client-php"},"Simple OIDC Client"),"."),(0,r.kt)("h4",{id:"install-simple-oidc-client-php"},"Install simple-oidc-client-php"),(0,r.kt)("p",null,"This guide assumes the Apache HTTP server has been installed and the document\nroot is ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/www/html")),(0,r.kt)("p",null,"Move to the apache document root and download and extract\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rciam/simple-oidc-client-php/releases/download/v2.3.1/simple-oidc-client-php-v2.3.1.zip"},"simple-oidc-client-php-v2.3.1.zip"),"."),(0,r.kt)("h4",{id:"configure-client"},"Configure Client"),(0,r.kt)("p",null,"To register the Client in the BETA instance of OpenAIRE AAI you need to send as\nan email as described in ",(0,r.kt)("a",{parentName:"p",href:"#client-registration"},"Client registration")," section and\ninclude a ",(0,r.kt)("inlineCode",{parentName:"p"},"Redirect URI")," (e.g.\n",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost/simple-oidc-client-php/refreshtoken.php"),"), the needed Grant\nType and Scopes. The Redirect URI must link to ",(0,r.kt)("inlineCode",{parentName:"p"},"refreshtoken.php")," which is\nlocated in simple-oidc-client-php directory."),(0,r.kt)("p",null,"A member of the OpenAIRE AAI Support team will take care of your request and\nthey will send you the ",(0,r.kt)("inlineCode",{parentName:"p"},"Client ID")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Client Secret"),"."),(0,r.kt)("h4",{id:"configure-simple-oidc-client-php"},"Configure simple-oidc-client-php"),(0,r.kt)("p",null,"Now that you have everything you need, you can configure your login settings. Go\nto your terminal and open ",(0,r.kt)("inlineCode",{parentName:"p"},"config.php")," with your favourite text editor."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"vi simple-oidc-client-php/config.php\n")),(0,r.kt)("p",null,"Let's go quickly through the settings:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"title")," required, the title on the navigation bar"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"img")," required, the source of the logo"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scope_info")," optional, a message that informs the user for the application\nrequirements"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"issuer")," required, the base URL of our IdentityServer instance. This will\nallow oidc-client to query the metadata endpoint so it can validate the tokens"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client_id")," required, the id of the client we want to use when hitting the\nauthorization endpoint"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client_secret")," optional, a value the offers better security to the message\nflow"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pkceCodeChallengeMethod")," optional, a string that defines the code challenge\nmethod for PKCE. Choose between ",(0,r.kt)("inlineCode",{parentName:"li"},"plain")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"S256"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"redirect_url")," required, the redirect URL where the client and the browser\nagree to send and receive correspondingly the code"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scopesDefine")," required, defines the scopes the client supports"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"refresh_token_note")," optional, info for the refresh token"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"access_token_note")," optional, info for the access token"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"manage_token_note")," optional, message the informs the user where can manage\nhis tokens"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"manageTokens")," optional, URL of the manage tokens service"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sessionName")," required, define the name of the cookie session"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sessionLifetime")," required, define the duration of the session. This must be\nequal to the validity time of the access token.")),(0,r.kt)("p",null,"You must change the followings options based on your Service configuration you\nsetup earlier:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"issuer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client_id")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client_secret")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"redirect_url")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scopesDefine")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sessionName")," (based on the installation path of the portal)")),(0,r.kt)("p",null,"An example configuration follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<?php\n// index.php interface configuration\n$title = "Generate Tokens";\n$img = "https://clickhelp.co/images/feeds/blog/2016.05/keys.jpg";\n$scope_info = "This service requires the following permissions for your account:";\n\n// Client configuration\n$issuer = "https://beta.aai.openaire.eu/oidc/";\n$client_id = "CHANGE_ME";\n$client_secret = "CHANGE_ME";  // comment if you are using PKCE\n// $pkceCodeChallengeMethod = "S256";   // uncomment to use PKCE\n$redirect_url = "http://localhost/simple-oidc-client-php/refreshtoken.php";\n// add scopes as keys and a friendly message of the scope as value\n$scopesDefine = array(\n    \'openid\' => \'log in using your identity\',\n    \'email\' => \'read your email address\',\n    \'profile\' => \'read your basic profile info\',\n);\n// refreshtoken.php interface configuration\n$refresh_token_note = "NOTE: New refresh tokens expire in 12 months.";\n$access_token_note = "NOTE: New access tokens expire in 1 hour.";\n$manage_token_note = "You can manage your refresh tokens in the following link: ";\n$manageTokens = $issuer . "manage/user/services";\n$sessionName = "simple-oidc-client-php";\n$sessionLifetime = 60*60;  // must be equal to access token validation time in seconds\n')),(0,r.kt)("h3",{id:"client-migration-to-keycloak"},"Client Migration to Keycloak"),(0,r.kt)("p",null,"The migration guide below applies to OIDC clients registered in the\nMITREid Connect based OpenID Provider of the OpenAIRE AAI."),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Beginning ",(0,r.kt)("strong",{parentName:"p"},"May 2, 2023"),", clients using the legacy OIDC endpoints\nin the ",(0,r.kt)("strong",{parentName:"p"},"BETA")," environment will no longer be supported."))),(0,r.kt)("h4",{id:"how-to-migrate-your-service-to-keycloak"},"How to Migrate your Service to Keycloak"),(0,r.kt)("p",null,"All the clients that were registered in MITREid Connect have been moved to\nKeycloak preserving all the options (Client ID, Client Secret, Redirect URIs\netc.), so you do not need to re-register your client."),(0,r.kt)("h5",{id:"new-endpoints"},"New Endpoints"),(0,r.kt)("p",null,"The first thing you need to do is to update the OIDC endpoints according to the\n",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoints")," table. If your OIDC Application/Library supports\n",(0,r.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-discovery-1_0.html"},"OpenID Connect Discovery"),",\nthen you only need to update the ",(0,r.kt)("inlineCode",{parentName:"p"},"issuer"),". Otherwise, you need to update all\nthe Endpoints separately, most notably the Authorization Endpoint, the Token\nEndpoint and the UserInfo Endpoint."),(0,r.kt)("h5",{id:"size-of-the-tokens"},"Size of the Tokens"),(0,r.kt)("p",null,"The size of the Access/Refresh Tokens issued by Keycloak is larger compared to\nthe respective Tokens issued by MITREid Connect. For example, the size of an\nAccess Token is around 1400 characters, depending on the information that is\nincluded in the payload of the JWT. So make sure that your OIDC implementation\ncan handle larger Tokens."),(0,r.kt)("h5",{id:"logout"},"Logout"),(0,r.kt)("p",null,"The Redirection URI query parameter in the logout request has been changed from\n",(0,r.kt)("inlineCode",{parentName:"p"},"redirect")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"post_logout_redirect_uri")," and MUST be URL encoded. Also, the\nallowed value(s) for the ",(0,r.kt)("inlineCode",{parentName:"p"},"post_logout_redirect_uri")," parameter MUST be\npre-registered in the client configuration on the OpenAIRE AAI. See\n",(0,r.kt)("a",{parentName:"p",href:"#logout-endpoint"},"Logout Endpoint")," for additional parameters that\nneed to be specified in the logout request."),(0,r.kt)("h5",{id:"token-introspection"},"Token Introspection"),(0,r.kt)("p",null,"The Token Introspection is available to all the clients that are using any\nauthentication method (",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret_basic"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret_post"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret_jwt")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"private_key_jwt"),") (Confidential Clients) to the Token\nEndpoint. Public Clients (clients that do not use any authentication method)\nwill not be able to get a successful response from the Introspection Endpoint."),(0,r.kt)("h5",{id:"pkce"},"PKCE"),(0,r.kt)("p",null,"Enabling Proof Key for Code Exchange (PKCE) is highly recommended to avoid code\ninjection and code replay attacks. If your client ",(0,r.kt)("strong",{parentName:"p"},"cannot")," use PKCE, please\nmake sure that PKCE is ",(0,r.kt)("strong",{parentName:"p"},"disabled")," in the client configuration on the OpenAIRE\nAAI. Otherwise, you will get the following HTTP response during authentication:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"error=invalid_request&error_description=Missing parameter: code_challenge_method\n")),(0,r.kt)("p",null,"To enable/disable PKCE for your client, you need to send your request via email\nto ",(0,r.kt)("inlineCode",{parentName:"p"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<AT>")," ",(0,r.kt)("inlineCode",{parentName:"p"},"openaire.eu"),", indicating the ",(0,r.kt)("inlineCode",{parentName:"p"},"client_id")," of the client."),(0,r.kt)("h5",{id:"device-code-grant"},"Device Code Grant"),(0,r.kt)("p",null,"If you are using a confidential client with the Device Code grant, please make\nsure that the ",(0,r.kt)("inlineCode",{parentName:"p"},"client_secret")," is present in the request to the Device Code\nEndpoint either as HTTP Basic or HTTP POST parameter (see\n",(0,r.kt)("a",{parentName:"p",href:"#1-device-authorization-request"},"Device Authorization Request"),")."),(0,r.kt)("h5",{id:"token-exchange-grant"},"Token Exchange Grant"),(0,r.kt)("p",null,"If you are using the Token Exchange grant, please make sure that the ",(0,r.kt)("inlineCode",{parentName:"p"},"audience"),"\n(optional parameter) defines the logical name of the service that the token will\nbe used for; when specified, it MUST match the client ID of a client registered in the OpenAIRE AAI otherwise an ",(0,r.kt)("inlineCode",{parentName:"p"},"invalid_client")," error is returned\n(",(0,r.kt)("inlineCode",{parentName:"p"},'"description": "audience not found"'),")."),(0,r.kt)("h5",{id:"client-credentials-grant"},"Client Credentials Grant"),(0,r.kt)("p",null,"If you are using the Client Credentials grant, there is a minor change in the\nresponses from UserInfo and Introspection Endpoints. The ",(0,r.kt)("strong",{parentName:"p"},"Client ID")," of the\nclient is released through the ",(0,r.kt)("inlineCode",{parentName:"p"},"client_id")," Claim instead of the ",(0,r.kt)("inlineCode",{parentName:"p"},"sub")," Claim.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"sub")," Claim is still present in the response but contains a unique, opaque,\nnon-reassignable identifier of the client, typically scoped ",(0,r.kt)("inlineCode",{parentName:"p"},"@openaire.eu"),"."),(0,r.kt)("h4",{id:"common-issues"},"Common issues"),(0,r.kt)("h5",{id:"error-messages-referring-to-missing-code_challenge-code_challenge_method-or-code_verifier-http-parameter"},"Error messages referring to missing ",(0,r.kt)("inlineCode",{parentName:"h5"},"code_challenge"),", ",(0,r.kt)("inlineCode",{parentName:"h5"},"code_challenge_method")," or ",(0,r.kt)("inlineCode",{parentName:"h5"},"code_verifier")," HTTP parameter"),(0,r.kt)("p",null,"If you get error messages containing the PKCE HTTP parameters, probably the PKCE\nmode is enabled in your Client Configuration but your OIDC Client library is not\nusing PKCE. To fix this, refer to the ",(0,r.kt)("a",{parentName:"p",href:"#pkce"},"PKCE section")," of the migration\nguide."),(0,r.kt)("h5",{id:"error-messages-referring-to-invalid_code"},"Error messages referring to ",(0,r.kt)("inlineCode",{parentName:"h5"},"invalid_code")),(0,r.kt)("p",null,"If you try to perform the Authorization Code flow and you get an ",(0,r.kt)("inlineCode",{parentName:"p"},"invalid_code"),"\nerror message, probably your OIDC Client sends the Authorization Request to the\nAuthorization Endpoint of the Keycloak based OpenAIRE OP and then sends the\n",(0,r.kt)("inlineCode",{parentName:"p"},"code")," to the Token Endpoint of the MITREid Connect based OpenAIRE OP or\nvice versa."),(0,r.kt)("p",null,"To fix this you need to verify that you have updated all the OIDC Endpoints with\nthe Keycloak ones. You can find all the OIDC Endpoints of Keycloak in the\n",(0,r.kt)("a",{parentName:"p",href:"#endpoints"},"Endpoint")," table."),(0,r.kt)("h5",{id:"error-messages-referring-to-the-redirect_uri"},"Error messages referring to the ",(0,r.kt)("inlineCode",{parentName:"h5"},"redirect_uri")),(0,r.kt)("p",null,"If you try to perform the Authorization Code flow and you get an\n",(0,r.kt)("inlineCode",{parentName:"p"},"invalid_redirect_uri")," error, probably the ",(0,r.kt)("inlineCode",{parentName:"p"},"redirect_uri")," in the Authorization\nRequest does not match any of the allowed Redirection URIs in the Client\nConfiguration."),(0,r.kt)("p",null,"To solve this, you need to send the updated list of allowed Redirection URIs via\nemail to ",(0,r.kt)("inlineCode",{parentName:"p"},"aai")," ",(0,r.kt)("inlineCode",{parentName:"p"},"<AT>")," ",(0,r.kt)("inlineCode",{parentName:"p"},"openaire.eu"),", indicating the ",(0,r.kt)("inlineCode",{parentName:"p"},"client_id")," of the client."),(0,r.kt)("h5",{id:"userinfo-invalid_token-or-401-unauthorized-error-response"},"UserInfo ",(0,r.kt)("inlineCode",{parentName:"h5"},"invalid_token")," or ",(0,r.kt)("inlineCode",{parentName:"h5"},"401 Unauthorized")," error response"),(0,r.kt)("p",null,"If you are trying to make a request to the UserInfo Endpoint and the response\ncontains the ",(0,r.kt)("inlineCode",{parentName:"p"},"invalid_token")," error message, probably you are using an invalid\nToken or the UserInfo Endpoint is wrong."),(0,r.kt)("p",null,"To solve this, please make sure the that:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"You have obtained an Keycloak issued Access Token and you make a request to\nthe Keycloak based UserInfo Endpoint"),(0,r.kt)("li",{parentName:"ol"},"You have added the Access Token to the Authorization header of the request")),(0,r.kt)("h5",{id:"502-bad-gateway-error-after-redirecting-back-to-the-service"},(0,r.kt)("inlineCode",{parentName:"h5"},"502 Bad Gateway")," error after redirecting back to the Service"),(0,r.kt)("p",null,"If you are using NGINX as a Reverse Proxy, and you are getting the following\nerror message in the logs:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"upstream sent too big header while reading response header from upstream")),(0,r.kt)("p",null,"Then you need to increase the size of the buffer by adding the following options\nin the vhost configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-nginx"},"proxy_buffers 4 256k;\nproxy_buffer_size 128k;\nproxy_busy_buffers_size 256k;\n")),(0,r.kt)("h2",{id:"user-attributes"},"User attributes"),(0,r.kt)("p",null,"This section defines the attributes that can be made available to services\nconnected to OpenAIRE AAI."),(0,r.kt)("h3",{id:"1-user-identifier"},"1. User Identifier"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"User Identifier"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"A globally unique, opaque, persistent and non-reassignable identifier for the user. For users whose community identity is managed by the OpenAIRE AAI, this identifier is of the form ",(0,r.kt)("inlineCode",{parentName:"td"},"<uniqueID>@openaire.eu"),", where the ",(0,r.kt)("inlineCode",{parentName:"td"},"<uniqueID>")," portion is an opaque identifier issued by the OpenAIRE AAI.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:1.3.6.1.4.1.25178.4.1.6")," (",(0,r.kt)("inlineCode",{parentName:"td"},"voPersonID"),")"),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"1.3.6.1.4.1.5923.1.1.1.13")," (",(0,r.kt)("inlineCode",{parentName:"td"},"eduPersonUniqueId"),")")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"voperson_id")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"aarc"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"voperson_id")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"sub"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"ID token"),(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The User Identifier is assigned by the OpenAIRE AAI or an external AAI service managing the community identity of the user")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"75bdcef46689f5d26ddfa00312365cc4fb5ce97e9ca87@aai.openaire.eu"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Use the User Identifier within your application as the unique identifier key for the user")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"2-display-name"},"2. Display Name"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Display Name"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The user's full name, in a displayable form")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:2.16.840.1.113730.3.1.241")," (",(0,r.kt)("inlineCode",{parentName:"td"},"displayName"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"profile")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"aarc"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"name"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Provided by the user's Identity Provider")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Single-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"John Doe"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"3-given-name"},"3. Given Name"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Given Name"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The user's first name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:2.5.4.42")," (",(0,r.kt)("inlineCode",{parentName:"td"},"givenName"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"profile")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"aarc"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"given_name"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Provided by the user's Identity Provider")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Single-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"John"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"4-family-name"},"4. Family Name"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Family Name"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The user's last name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:2.5.4.4")," (",(0,r.kt)("inlineCode",{parentName:"td"},"sn"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"profile")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"aarc"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"family_name"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Provided by the user's Identity Provider")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Single-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"Doe"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"5-email-address"},"5. Email Address"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Email Address"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The user's email address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:0.9.2342.19200300.100.1.3")," (",(0,r.kt)("inlineCode",{parentName:"td"},"mail"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"email")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"aarc"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"email"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Provided by the user's Identity Provider or supplied by the user during registration")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Single-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"john.doe@example.org"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"This ",(0,r.kt)("strong",{parentName:"td"},"MAY NOT")," be unique and is ",(0,r.kt)("strong",{parentName:"td"},"NOT")," suitable for use as a primary key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"6-verified-email-flag"},"6. Verified email flag"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Verified email flag"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"True if the user's email address has been verified; otherwise false")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"email")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"aarc"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"email_verified"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Provided by the user's Identity Provider or by the OpenAIRE AAI following email address verification")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Single-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"true"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"This claim is available only in OpenID Connect")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"8-affiliation"},"8. Affiliation"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Affiliation"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The user's affiliation(s) within a particular security domain (scope)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:1.3.6.1.4.1.25178.4.1.11")," (",(0,r.kt)("inlineCode",{parentName:"td"},"voPersonExternalAffiliation"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"voperson_external_affiliation")),(0,r.kt)("li",null,(0,r.kt)("inlineCode",{parentName:"td"},"aarc"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"voperson_external_affiliation"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Provided by the user's Identity Provider")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Multi-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Only when provided by the user's identity provider")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"member@example.org"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The ",(0,r.kt)("inlineCode",{parentName:"td"},"voperson_external_affiliation")," claim is multi-valued, so it is always returned as an array in the UserInfo response.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"9-groups"},"9. Groups"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Groups"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The user's group/VO membership/role information expressed as entitlements")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:1.3.6.1.4.1.5923.1.1.1.7")," (",(0,r.kt)("inlineCode",{parentName:"td"},"eduPersonEntitlement"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"eduperson_entitlement"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"eduperson_entitlement"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Group memberships are managed by group administrators")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Multi-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Not always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:mace:example.org:group:vo.example.org:role=vm_operator#aai.openaire.eu"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Stable")))),(0,r.kt)("h3",{id:"10-orcid-id"},"10. ORCID iD"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"attribute name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"ORCID iD"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The user's ORCID iD")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"SAML Attribute(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"urn:oid:1.3.6.1.4.1.5923.1.1.1.16")," (",(0,r.kt)("inlineCode",{parentName:"td"},"eduPersonOrcid"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC scope")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"orcid"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim(s)")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"orcid"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"OIDC claim location")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("ul",null,(0,r.kt)("li",null,"Userinfo endpoint"),(0,r.kt)("li",null,"Introspection endpoint")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"origin")),(0,r.kt)("td",{parentName:"tr",align:"left"},"ORCID Identity Provider")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"changes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"multiplicity")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Single-valued")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"availability")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Not always")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"example")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"https://orcid.org/XXXX-XXXX-XXXX-XXXX"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"notes")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Available when user logs in using ORCID or when provided by the user's Identity Provider")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},(0,r.kt)("strong",{parentName:"td"},"status")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Experimental")))),(0,r.kt)("h2",{id:"user-authorisation"},"User authorisation"),(0,r.kt)("p",null,"The following information about the authenticated user can be provided by\nOpenAIRE AAI in order to control user access to resources:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"VO/group membership and role information about the authenticated user")),(0,r.kt)("h3",{id:"vogroup-membership-and-role-information"},"VO/group membership and role information"),(0,r.kt)("h4",{id:"background"},"Background"),(0,r.kt)("p",null,"VO/group membership and role information is encoded in entitlements\n(",(0,r.kt)("inlineCode",{parentName:"p"},"eduPersonEntitlement")," attribute values in SAML or ",(0,r.kt)("inlineCode",{parentName:"p"},"eduperson_entitlement"),"\nclaim in OIDC). These entitlements are typically used to indicate access rights\nto protected resources. Entitlements are multi-valued, with each value formatted\nas a URN."),(0,r.kt)("h4",{id:"syntax"},"Syntax"),(0,r.kt)("p",null,"An entitlement value expressing group membership and role information has the\nfollowing syntax (components enclosed in square brackets are OPTIONAL):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"urn:mace:example.org:group:<GROUP>[:<SUBGROUP>*][:role=<ROLE>]#<GROUP-AUTHORITY>\n")),(0,r.kt)("p",null,"where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<GROUP>")," is the name of a VO, research collaboration or a top level arbitrary\ngroup. ",(0,r.kt)("inlineCode",{parentName:"li"},"<GROUP>")," names are unique within the ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:mace:example.org:group"),"\nnamespace;"),(0,r.kt)("li",{parentName:"ul"},"zero or more ",(0,r.kt)("inlineCode",{parentName:"li"},"<SUBGROUP>")," components represent the hierarchy of subgroups in\nthe ",(0,r.kt)("inlineCode",{parentName:"li"},"<GROUP>"),"; specifying sub-groups is optional"),(0,r.kt)("li",{parentName:"ul"},"the optional ",(0,r.kt)("inlineCode",{parentName:"li"},"<ROLE>")," component is scoped to the rightmost (sub)group; if no\ngroup information is specified, the role applies to the VO"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<GROUP-AUTHORITY>")," is a non-empty string that indicates the authoritative\nsource for the entitlement value. For example, it can be the FQDN of the group\nmanagement system that is responsible for the identified group membership\ninformation")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"urn:mace:example.org:group:vo.example.org:role=member#aai.openaire.eu\n")))}k.isMDXComponent=!0}}]);